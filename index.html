<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trucksafe ELP Violation Analytics Dashboard</title>
  <link rel="icon" href="https://static.wixstatic.com/media/bb03f1_6b91954720844c2d88de1cdf16213d0c~mv2.png/v1/fill/w_32,h_32,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Trucksafe%20Badge.png">
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <script>
    // Detect if we're in an iframe and disable scrolling
    if (window.self !== window.top) {
      document.addEventListener('DOMContentLoaded', function() {
        document.body.style.overflow = 'hidden';
        document.documentElement.style.overflow = 'hidden';
      });
    }
  </script>
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    ul, ol { list-style: none; }
    ::before, ::after { content: none !important; }
    
    body { margin: 0; padding: 0; padding-bottom: 2rem; background: #f8fafc; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; }
    
    .stat-card { transition: all 0.3s ease; cursor: pointer; }
    .stat-card:hover { transform: translateY(-4px); box-shadow: 0 12px 24px rgba(30, 58, 138, 0.15); }
    
    /* iOS-style Toggle Switch */
    .ios-toggle {
      position: relative;
      display: inline-block;
      width: 220px;
      height: 40px;
      background: #e5e7eb;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .ios-toggle-slider {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 107px;
      height: 34px;
      background: #1e3a8a;
      border-radius: 17px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 13px;
      color: white;
      z-index: 2;
    }
    
    .ios-toggle.all-mode {
      background: #dbeafe;
    }
    
    .ios-toggle.all-mode .ios-toggle-slider {
      left: 110px;
      background: #3b82f6;
    }
    
    .ios-toggle-label {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 13px;
      font-weight: 500;
      transition: all 0.3s ease;
      pointer-events: none;
      z-index: 1;
      color: #9ca3af;
    }
    
    .ios-toggle-label.left {
      left: 20px;
    }
    
    .ios-toggle-label.right {
      right: 14px;
    }
    
    .timeline-event { position: relative; cursor: pointer; transition: all 0.2s ease; }
    .timeline-event:hover { transform: scale(1.1); }
    
    .tooltip-popup {
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-bottom: 12px;
      padding: 16px;
      background: white;
      border: 2px solid #1e3a8a;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      z-index: 50;
      width: 280px;
      display: none;
    }
    
    .tooltip-popup.active { display: block; }
    
    .toggle-btn { transition: all 0.3s ease; }
    .toggle-btn.active { background: #1e3a8a; color: white; }
    
    .date-range-btn { transition: all 0.3s ease; }
    .date-range-btn.active { background: #1e3a8a; color: white; }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    
    .state-bubble { 
      position: absolute; 
      border-radius: 50%; 
      cursor: pointer; 
      transition: all 0.3s ease;
      border: 3px solid white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .state-bubble:hover { 
      transform: scale(1.1); 
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50">
  
  <!-- Header -->
  <div class="bg-gradient-to-r from-[#1e3a8a] to-[#0f172a] text-white shadow-xl">
    <div class="max-w-7xl mx-auto px-6 py-6">
      <div class="flex items-center gap-4">
        <img src="https://static.wixstatic.com/media/bb03f1_6b91954720844c2d88de1cdf16213d0c~mv2.png/v1/fill/w_96,h_60,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Trucksafe%20Badge.png" alt="Trucksafe" class="h-12">
        <div>
          <h1 class="text-2xl font-bold">ELP Out-of-Service Analytics</h1>
          <p class="text-sm text-blue-200">Real-time enforcement tracking â€¢ 49 CFR Â§ 391.11(b)(2)</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="max-w-7xl mx-auto px-6 py-6">
    
    <!-- Data Source Notice -->
    <div id="sampleDataNotice" class="bg-orange-50 border-l-4 border-orange-500 p-4 mb-6 rounded-r-lg">
      <div class="flex items-start gap-3">
        <svg class="w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
        </svg>
        <div class="text-sm text-orange-900">
          <strong>Sample Data Demonstration:</strong> This dashboard currently displays representative sample data modeling typical ELP enforcement patterns. Production version will connect to live FMCSA API for real-time violation data.
        </div>
      </div>
    </div>
    
    <!-- Data Freshness Notice -->
    <div class="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6 rounded-r-lg">
      <div class="flex items-start gap-3">
        <svg class="w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
        </svg>
        <div class="text-sm text-blue-900">
          <strong>Data Freshness:</strong> Source data last updated by FMCSA on <strong id="dataFreshnessDate">February 10, 2026</strong>. Dashboard reflects violation data through this date. FMCSA updates enforcement data daily.
        </div>
      </div>
    </div>
    
    <!-- Introduction Panel -->
    <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white rounded-xl shadow-xl p-6 mb-6 fade-in">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2">
          <h2 class="text-2xl font-bold mb-3">About This Dashboard</h2>
          <p class="text-blue-100 mb-4 leading-relaxed">
            This dashboard tracks <strong>English Language Proficiency (ELP)</strong> violations under 49 CFR Â§ 391.11(b)(2), which requires commercial motor vehicle drivers to read and speak English sufficiently to converse with the general public, understand highway traffic signs, respond to official inquiries, and make entries on reports and records.
          </p>
          <p class="text-blue-100 mb-4 leading-relaxed">
            Following <strong>Executive Order 14286</strong> (April 2025), the restoration of ELP to Out-of-Service criteria (June 25, 2025), and Congressional codification in the FY2026 spending bill, enforcement has intensified dramatically.
          </p>
          <div class="flex flex-wrap gap-3">
            <a href="https://data.transportation.gov/Trucking-and-Motorcoaches/Vehicle-Inspections-and-Violations/876r-jsdb/about_data" target="_blank" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm font-medium transition">
              ðŸ“Š View Raw FMCSA Data â†’
            </a>
            <a href="https://www.trucksafe.com/post/trump-cracks-down-on-english-proficiency-among-truck-drivers-in-new-executive-order" target="_blank" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm font-medium transition">
              ðŸ“° Read Full Analysis â†’
            </a>
          </div>
        </div>
        
        <!-- Embedded YouTube Video -->
        <div class="lg:col-span-1">
          <div class="bg-black rounded-lg overflow-hidden shadow-2xl">
            <iframe 
              width="100%" 
              height="200" 
              src="https://www.youtube.com/embed/QWXvrCsjjFQ?start=137" 
              title="ELP Enforcement Explained" 
              frameborder="0" 
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
              allowfullscreen
              class="w-full"
            ></iframe>
          </div>
          <p class="text-xs text-blue-200 mt-2 text-center">Expert analysis by Trucksafe Consulting</p>
        </div>
      </div>
    </div>

    <!-- Regulatory Timeline -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in">
      <h3 class="text-lg font-bold text-gray-800 mb-6">Regulatory Timeline</h3>
      
      <div class="relative">
        <div class="absolute top-10 left-0 right-0 h-1 bg-gradient-to-r from-blue-300 via-orange-300 to-red-500"></div>
        
        <div class="relative flex justify-between pt-4">
          
          <div class="timeline-event flex flex-col items-center" style="flex: 1;" onclick="toggleTooltip(event, 0)">
            <div class="w-12 h-12 rounded-full bg-blue-600 flex items-center justify-center shadow-lg">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            </div>
            <div class="text-xs font-bold text-gray-700 mt-2">2005</div>
            <div class="text-xs text-gray-600 text-center px-1">CVSA Adds</div>
            
            <div class="tooltip-popup" onclick="event.stopPropagation()">
              <div class="text-sm font-bold text-[#1e3a8a] mb-2">CVSA Adds ELP to OOS</div>
              <div class="text-xs text-gray-600 mb-3">2005 FMCSA policy memorandum and CVSA update adds English Language Proficiency violations to Out-of-Service criteria.</div>
              <div class="text-xs text-gray-500 italic">Click outside to close</div>
            </div>
          </div>
          
          <div class="timeline-event flex flex-col items-center" style="flex: 1;" onclick="toggleTooltip(event, 1)">
            <div class="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center shadow-lg">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"/></svg>
            </div>
            <div class="text-xs font-bold text-gray-700 mt-2">2015</div>
            <div class="text-xs text-gray-600 text-center px-1">Removed</div>
            
            <div class="tooltip-popup" onclick="event.stopPropagation()">
              <div class="text-sm font-bold text-[#1e3a8a] mb-2">CVSA Removes ELP from OOS</div>
              <div class="text-xs text-gray-600 mb-3">ELP violations removed from OOS criteria, leading to less strict enforcement for 10 years.</div>
              <div class="text-xs text-gray-500 italic">Click outside to close</div>
            </div>
          </div>
          
          <div class="timeline-event flex flex-col items-center" style="flex: 1;" onclick="toggleTooltip(event, 2)">
            <div class="w-12 h-12 rounded-full bg-red-600 flex items-center justify-center shadow-lg animate-pulse">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"/></svg>
            </div>
            <div class="text-xs font-bold text-red-700 mt-2">Apr 2025</div>
            <div class="text-xs text-red-600 font-semibold text-center px-1">Exec Order</div>
            
            <div class="tooltip-popup" onclick="event.stopPropagation()">
              <div class="text-sm font-bold text-red-700 mb-2">Executive Order 14286</div>
              <div class="text-xs text-gray-600 mb-3">President Trump signs "Enforcing Commonsense Rules of the Road," directing strict ELP enforcement.</div>
              <a href="https://www.whitehouse.gov/presidential-actions/2025/04/enforcing-commonsense-rules-of-the-road-for-americas-truck-drivers/" target="_blank" class="text-xs text-blue-600 hover:underline font-semibold block mb-1">Read Executive Order â†’</a>
              <div class="text-xs text-gray-500 italic">Click outside to close</div>
            </div>
          </div>
          
          <div class="timeline-event flex flex-col items-center" style="flex: 1;" onclick="toggleTooltip(event, 3)">
            <div class="w-12 h-12 rounded-full bg-red-600 flex items-center justify-center shadow-lg animate-pulse">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
            </div>
            <div class="text-xs font-bold text-red-700 mt-2">May 2025</div>
            <div class="text-xs text-red-600 font-semibold text-center px-1">New Policy</div>
            
            <div class="tooltip-popup" onclick="event.stopPropagation()">
              <div class="text-sm font-bold text-red-700 mb-2">FMCSA Enforcement Policy</div>
              <div class="text-xs text-gray-600 mb-3">FMCSA issues updated enforcement policy with mandatory two-step assessment for drivers.</div>
              <a href="https://www.fmcsa.dot.gov/sites/fmcsa.dot.gov/files/2025-05/FMCSA%20ELP%20Guidance%20with%20Attachments%20Final%20%285-20-2025%29_Redacted.pdf" target="_blank" class="text-xs text-blue-600 hover:underline font-semibold block mb-1">View Policy Document (PDF) â†’</a>
              <div class="text-xs text-gray-500 italic">Click outside to close</div>
            </div>
          </div>
          
          <div class="timeline-event flex flex-col items-center" style="flex: 1;" onclick="toggleTooltip(event, 4)">
            <div class="w-12 h-12 rounded-full bg-red-700 flex items-center justify-center shadow-lg animate-pulse">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
            </div>
            <div class="text-xs font-bold text-red-700 mt-2">Jun 2025</div>
            <div class="text-xs text-red-600 font-semibold text-center px-1">OOS Restored</div>
            
            <div class="tooltip-popup" onclick="event.stopPropagation()">
              <div class="text-sm font-bold text-red-700 mb-2">OOS Criteria Restored</div>
              <div class="text-xs text-gray-600 mb-3">CVSA reintegrates ELP into OOS criteria effective June 25, 2025. Violations trigger immediate driver suspension.</div>
              <a href="https://cvsa.org/news/elp-oosc/" target="_blank" class="text-xs text-blue-600 hover:underline font-semibold block mb-1">Read CVSA Announcement â†’</a>
              <div class="text-xs text-gray-500 italic">Click outside to close</div>
            </div>
          </div>

          <div class="timeline-event flex flex-col items-center" style="flex: 1;" onclick="toggleTooltip(event, 5)">
            <div class="w-12 h-12 rounded-full bg-purple-700 flex items-center justify-center shadow-lg animate-pulse">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            </div>
            <div class="text-xs font-bold text-purple-700 mt-2">Feb 2026</div>
            <div class="text-xs text-purple-600 font-semibold text-center px-1">Codified</div>
            
            <div class="tooltip-popup" onclick="event.stopPropagation()">
              <div class="text-sm font-bold text-purple-700 mb-2">Congressional Codification</div>
              <div class="text-xs text-gray-600 mb-3">FY2026 Continuing Appropriations and Extensions Act (H.R. 7148) codifies ELP as permanent OOS criterion, making it federal law.</div>
              <a href="https://www.congress.gov/bill/119th-congress/house-bill/7148/text" target="_blank" class="text-xs text-blue-600 hover:underline font-semibold block mb-1">Read Bill Text â†’</a>
              <div class="text-xs text-gray-500 italic">Click outside to close</div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
    
    <!-- View Toggle & OOS Note -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in">
      <div class="flex flex-col md:flex-row items-start md:items-center gap-6">
        <!-- Toggle Switch -->
        <div class="flex items-center gap-4">
          <span class="text-sm font-semibold text-gray-700">View:</span>
          <div class="ios-toggle" id="iosToggle" onclick="toggleViewSwitch()">
            <span class="ios-toggle-label left">OOS Only</span>
            <div class="ios-toggle-slider" id="iosSlider">OOS Only</div>
            <span class="ios-toggle-label right">All Violations</span>
          </div>
        </div>
        
        <!-- OOS Note -->
        <div class="flex items-start gap-2 flex-1">
          <svg class="w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
          </svg>
          <div class="text-xs text-gray-700">
            <strong>Note:</strong> While CVSA restored ELP to OOS criteria on June 25, 2025, not all ELP violations result in out-of-service orders. Violations in border zones and certain circumstances may receive citations without immediate OOS placement.
          </div>
        </div>
      </div>
    </div>
    
    <!-- KPI Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="stat-card bg-white rounded-xl shadow-lg p-5 border-l-4 border-[#1e3a8a]">
        <div class="text-sm font-semibold text-gray-600 mb-1" id="statLabel">TOTAL OOS</div>
        <div class="text-3xl font-bold text-[#1e3a8a]" id="statOOS">527</div>
        <div class="text-xs text-gray-500 mt-1" id="statDateRange">Since June 25, 2025</div>
      </div>
      
      <div class="stat-card bg-white rounded-xl shadow-lg p-5 border-l-4 border-orange-500">
        <div class="text-sm font-semibold text-gray-600 mb-1">MONTH OVER MONTH</div>
        <div class="text-3xl font-bold text-orange-500" id="statMoM">-4.4%</div>
        <div class="text-xs text-gray-500 mt-1" id="momLabel">Feb vs Jan 2026</div>
      </div>
      
      <div class="stat-card bg-white rounded-xl shadow-lg p-5 border-l-4 border-green-600">
        <div class="text-sm font-semibold text-gray-600 mb-1">AVG PER MONTH</div>
        <div class="text-3xl font-bold text-green-600" id="statAvg">67</div>
        <div class="text-xs text-gray-500 mt-1">Last 9 months</div>
      </div>
      
      <div class="stat-card bg-white rounded-xl shadow-lg p-5 border-l-4 border-blue-500">
        <div class="text-sm font-semibold text-gray-600 mb-1">PEAK MONTH</div>
        <div class="text-3xl font-bold text-blue-500" id="statPeak">Oct '25</div>
        <div class="text-xs text-gray-500 mt-1" id="statPeakCount">73 violations</div>
      </div>
    </div>

    <!-- Main Charts Row -->
    <div class="mb-6">
      
      <!-- Monthly Trend - Full Width -->
      <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-bold text-gray-800" id="chartTitle">OOS Enforcement Trend</h3>
          <span class="text-xs text-gray-500" id="chartDateRange">June 2025 - February 2026</span>
        </div>
        <canvas id="trendChart" height="80"></canvas>
        <div class="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
          <p class="text-xs text-blue-900" id="keyInsight"><strong>Key Insight:</strong> Loading data...</p>
        </div>
      </div>
    </div>

    <!-- Biggest Movers -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in">
      <h3 class="text-lg font-bold text-gray-800 mb-4">Biggest Movers - Month over Month</h3>
      <p class="text-sm text-gray-600 mb-4" id="biggestMoversSubtitle">States with largest change in OOS violations</p>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Top Increases -->
        <div>
          <h4 class="font-semibold text-red-700 mb-3 flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/></svg>
            Top 3 Increases
          </h4>
          <div class="space-y-3" id="biggestIncreases">
            <!-- Populated by JavaScript -->
          </div>
        </div>
        
        <!-- Top Decreases -->
        <div>
          <h4 class="font-semibold text-green-700 mb-3 flex items-center gap-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M14.707 12.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
            Top 3 Decreases
          </h4>
          <div class="space-y-3" id="biggestDecreases">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Top 10 States -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-gray-800">Top 10 States - OOS Violations</h3>
        <span class="text-sm text-gray-600 font-semibold">Data: June 25, 2025 - February 13, 2026</span>
      </div>
      <div class="space-y-2" id="topStatesList">
        <!-- Populated by JavaScript -->
      </div>
    </div>
    <!-- State Detail Analysis -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-6 fade-in">
      <h3 class="text-lg font-bold text-gray-800 mb-4">State Detail Analysis</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <!-- State Selector -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Select State</label>
          <select id="stateSelector" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="">Choose a state...</option>
          </select>
        </div>
        
        <!-- Time Range Selector -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Time Range</label>
          <select id="timeRangeSelector" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="all">Since Jun 2025</option>
            <option value="1">Last Month</option>
            <option value="3">Last 3 Months</option>
            <option value="6">Last 6 Months</option>
            <option value="12">Last 12 Months</option>
          </select>
        </div>
      </div>
      
      <!-- State Stats Display -->
      <div id="stateDetailContent" class="hidden">
        <!-- Summary Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
            <div class="text-xs text-gray-600 mb-1">Total Violations</div>
            <div class="text-2xl font-bold text-blue-600" id="stateTotal">-</div>
          </div>
          <div class="bg-red-50 rounded-lg p-4 border border-red-200">
            <div class="text-xs text-gray-600 mb-1">OOS Violations</div>
            <div class="text-2xl font-bold text-red-600" id="stateOOS">-</div>
          </div>
          <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
            <div class="text-xs text-gray-600 mb-1">Trend Direction</div>
            <div class="text-2xl font-bold text-purple-600" id="stateTrend">-</div>
            <div class="text-xs text-gray-500 mt-1" id="stateTrendLabel">-</div>
          </div>
          <div class="bg-green-50 rounded-lg p-4 border border-green-200">
            <div class="text-xs text-gray-600 mb-1">National Rank</div>
            <div class="text-2xl font-bold text-green-600" id="stateRank">-</div>
          </div>
        </div>
        
        <!-- Monthly Trend Chart -->
        <div class="bg-gray-50 rounded-lg p-4">
          <h4 class="text-sm font-bold text-gray-700 mb-3" id="stateChartTitle">Monthly Trend</h4>
          <div style="height: 300px;">
            <canvas id="stateDetailChart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Empty State -->
      <div id="stateDetailEmpty" class="text-center py-12 text-gray-500">
        <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
        <p class="text-sm">Select a state and time range to view detailed analytics</p>
      </div>
    </div>

    <!-- Footer -->
    <div class="bg-gradient-to-r from-[#1e3a8a] to-[#0f172a] text-white rounded-xl p-8 shadow-xl">
      <div class="flex flex-col md:flex-row items-center justify-between gap-6">
        <div class="flex items-center gap-4">
          <img src="https://static.wixstatic.com/media/bb03f1_6b91954720844c2d88de1cdf16213d0c~mv2.png/v1/fill/w_96,h_60,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Trucksafe%20Badge.png" alt="Trucksafe" class="h-12">
          <div>
            <h3 class="text-lg font-bold">Powered by Trucksafe Consulting, LLC</h3>
            <p class="text-sm text-blue-200">Expert DOT compliance consulting & training</p>
          </div>
        </div>
        <div class="flex gap-3">
          <a href="https://www.trucksafe.com" target="_blank" class="bg-white text-[#1e3a8a] px-6 py-3 rounded-lg font-semibold hover:bg-blue-50 transition">
            Visit Website
          </a>
          <a href="https://www.trucksafe.com/contact" target="_blank" class="bg-orange-600 px-6 py-3 rounded-lg font-semibold hover:bg-orange-700 transition">
            Get Help
          </a>
        </div>
      </div>
      <div class="text-center mt-6 pt-6 border-t border-blue-400/30">
        <p class="text-sm text-blue-200">Â© 2026 Trucksafe Consulting, LLC. All rights reserved.</p>
      </div>
    </div>
  </div>

  <script>
    let currentView = 'oos';
    let trendChart;
    let activeTooltip = null;
    let realData = null;

    // Load real data from JSON
    async function loadRealData() {
      try {
        const response = await fetch('elp_data.json');
        if (!response.ok) {
          console.warn('Real data not available, using sample data');
          return null;
        }
        const data = await response.json();
        console.log('âœ“ Real FMCSA data loaded successfully');
        return data;
      } catch (error) {
        console.warn('Error loading real data, using sample data:', error);
        return null;
      }
    }

    // Sample data (fallback)
    const sampleData = {
      last_updated: "February 10, 2026 (Sample Data)",
      total_oos: 527,
      total_all: 1247,
      oos_rate: 42.3,
      avg_per_month: 67,
      peak_month: "Oct '25",
      peak_count: 73,
      mom_change: -4.4,
      monthly: {
        labels: ['Jun 25', 'Jul 25', 'Aug 25', 'Sep 25', 'Oct 25', 'Nov 25', 'Dec 25', 'Jan 26', 'Feb 26'],
        oos: [58, 61, 65, 69, 73, 67, 71, 68, 65],
        all: [142, 148, 156, 165, 174, 168, 175, 172, 169]
      },
      states: [
        {state: "CA", oos: 186, all: 438},
        {state: "TX", oos: 171, all: 402},
        {state: "FL", oos: 145, all: 342},
        {state: "NY", oos: 121, all: 285},
        {state: "IL", oos: 97, all: 228},
        {state: "PA", oos: 89, all: 210},
        {state: "OH", oos: 76, all: 179},
        {state: "GA", oos: 68, all: 160},
        {state: "NC", oos: 59, all: 139},
        {state: "WA", oos: 52, all: 122}
      ],
      biggest_movers: {
        increases: [
          {state: "AZ", previous: 12, current: 18, change: 50.0},
          {state: "NM", previous: 8, current: 11, change: 37.5},
          {state: "NV", previous: 15, current: 20, change: 33.3}
        ],
        decreases: [
          {state: "MI", previous: 24, current: 16, change: -33.3},
          {state: "NJ", previous: 18, current: 13, change: -27.8},
          {state: "WA", previous: 22, current: 17, change: -22.7}
        ]
      },
      state_count: 15
    };

    async function initDashboard() {
      // Load real or sample data
      realData = await loadRealData() || sampleData;
      
      // Update data freshness notice
      const isSample = realData === sampleData;
      document.getElementById('dataFreshnessDate').textContent = realData.last_updated;
      
      if (isSample) {
        // Show sample data warning
        document.getElementById('sampleDataNotice').style.display = 'block';
      } else {
        // Hide sample data warning
        document.getElementById('sampleDataNotice').style.display = 'none';
      }
      
      // Initialize chart with real data
      initChart();
      
      // Populate state selector for state detail analysis
      populateStateSelector();
      
      // Update KPI cards
      updateKPIs();
      
      // Update biggest movers
      updateBiggestMovers();
      
      // Update top 10 states
      updateTopStates();
    }

    function updateKPIs() {
      document.getElementById('statOOS').textContent = realData.total_oos.toLocaleString();
      document.getElementById('statMoM').textContent = (realData.mom_change > 0 ? '+' : '') + realData.mom_change + '%';
      document.getElementById('statAvg').textContent = realData.avg_per_month;
      document.getElementById('statPeak').textContent = realData.peak_month;
      document.getElementById('statPeakCount').textContent = realData.peak_count.toLocaleString() + ' violations';
      
      // Calculate actual date range from data
      if (realData.monthly && realData.monthly.labels && realData.monthly.labels.length > 0) {
        const firstMonth = realData.monthly.labels[0];
        const lastMonth = realData.monthly.labels[realData.monthly.labels.length - 1];
        const dateRangeText = `${firstMonth} - ${lastMonth}`;
        
        // Update chart date range
        document.getElementById('chartDateRange').textContent = dateRangeText;
        
        // Update stat card date range (show start date only)
        document.getElementById('statDateRange').textContent = `Since ${firstMonth}`;
        
        // Update Month-over-Month label with actual months (using last 2 FULL months)
        if (realData.monthly.labels.length >= 3) {
          const lastFullMonth = realData.monthly.labels[realData.monthly.labels.length - 2];
          const previousFullMonth = realData.monthly.labels[realData.monthly.labels.length - 3];
          document.getElementById('momLabel').textContent = `${lastFullMonth} vs ${previousFullMonth}`;
        } else if (realData.monthly.labels.length >= 2) {
          const lastMonthLabel = realData.monthly.labels[realData.monthly.labels.length - 1];
          const secondLastMonthLabel = realData.monthly.labels[realData.monthly.labels.length - 2];
          document.getElementById('momLabel').textContent = `${lastMonthLabel} vs ${secondLastMonthLabel}`;
        }
      }
      
      // Update dynamic key insight
      updateKeyInsight();
    }

    function updateKeyInsight() {
      if (!realData || !realData.monthly || !realData.monthly.labels.length) {
        document.getElementById('keyInsight').innerHTML = '<strong>Key Insight:</strong> Loading data...';
        return;
      }
      
      const labels = realData.monthly.labels;
      const oosData = currentView === 'oos' ? realData.monthly.oos : realData.monthly.all;
      const peakMonth = realData.peak_month;
      const peakCount = realData.peak_count;
      
      // Find trend in recent months (last 3 months)
      const recentMonths = oosData.slice(-3);
      const trend = recentMonths[2] < recentMonths[1] ? 'decline' : recentMonths[2] > recentMonths[1] ? 'increase' : 'stabilization';
      const lastMonth = labels[labels.length - 1];
      
      const insight = `<strong>Key Insight:</strong> Peak enforcement occurred in ${peakMonth} (${peakCount.toLocaleString()} violations). Recent months show ${trend} with ${oosData[oosData.length - 1].toLocaleString()} violations in ${lastMonth}.`;
      
      document.getElementById('keyInsight').innerHTML = insight;
    }

    function updateBiggestMovers() {
      // Update subtitle with actual months being compared
      const monthlyLabels = realData.monthly.labels;
      if (monthlyLabels && monthlyLabels.length >= 3) {
        const lastFullMonth = monthlyLabels[monthlyLabels.length - 2];
        const prevFullMonth = monthlyLabels[monthlyLabels.length - 3];
        document.getElementById('biggestMoversSubtitle').textContent = 
          `States with largest change in OOS violations (${prevFullMonth} vs ${lastFullMonth})`;
      }
      
      // Update increases
      const increasesHTML = realData.biggest_movers.increases.map(item => `
        <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200">
          <div>
            <div class="font-bold text-gray-800">${item.state}</div>
            <div class="text-xs text-gray-600">${item.previous} â†’ ${item.current} violations</div>
          </div>
          <div class="text-2xl font-bold text-red-600">+${item.change.toFixed(0)}%</div>
        </div>
      `).join('');
      
      // Update decreases
      const decreasesHTML = realData.biggest_movers.decreases.map(item => `
        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-200">
          <div>
            <div class="font-bold text-gray-800">${item.state}</div>
            <div class="text-xs text-gray-600">${item.previous} â†’ ${item.current} violations</div>
          </div>
          <div class="text-2xl font-bold text-green-600">${item.change.toFixed(0)}%</div>
        </div>
      `).join('');
      
      document.getElementById('biggestIncreases').innerHTML = increasesHTML || '<p class="text-sm text-gray-500 text-center py-4">No data available</p>';
      document.getElementById('biggestDecreases').innerHTML = decreasesHTML || '<p class="text-sm text-gray-500 text-center py-4">No data available</p>';
    }

    function updateTopStates() {
      // Filter out "US" (federal violations) from state rankings, then take top 10
      const statesOnly = realData.states.filter(s => s.state.toUpperCase() !== 'US');
      const top10 = statesOnly.slice(0, 10);
      
      const topStatesHTML = top10.map((state, index) => {
        const maxOOS = statesOnly[0].oos;
        const widthPercent = (state.oos / maxOOS) * 100;
        
        return `
          <div class="flex items-center gap-3 p-3 hover:bg-blue-50 rounded-lg transition">
            <div class="w-8 text-sm font-bold text-[#1e3a8a]">${index + 1}</div>
            <div class="w-12 text-sm font-bold text-gray-700">${state.state}</div>
            <div class="flex-1">
              <div class="h-8 bg-gradient-to-r from-[#1e3a8a] to-[#3b82f6] rounded-lg flex items-center px-3 text-white text-sm font-semibold" style="width: ${widthPercent}%;">${state.oos} OOS violations</div>
            </div>
            <div class="text-xs text-gray-500">${state.all} total</div>
          </div>
        `;
      }).join('');
      
      document.getElementById('topStatesList').innerHTML = topStatesHTML;
    }

    function initChart() {
      const ctx = document.getElementById('trendChart').getContext('2d');
      trendChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: realData.monthly.labels,
          datasets: [{
            label: 'OOS Violations',
            data: realData.monthly.oos,
            borderColor: '#1e3a8a',
            backgroundColor: 'rgba(30, 58, 138, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 5,
            pointHoverRadius: 7,
            pointBackgroundColor: '#1e3a8a',
            pointBorderColor: '#fff',
            pointBorderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(30, 58, 138, 0.9)',
              titleColor: '#fff',
              bodyColor: '#fff',
              borderColor: '#1e3a8a',
              borderWidth: 2,
              padding: 12,
              displayColors: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(0, 0, 0, 0.05)' },
              ticks: { font: { size: 12 } }
            },
            x: {
              grid: { display: false },
              ticks: { font: { size: 11 } }
            }
          }
        }
      });
    }

    function toggleViewSwitch() {
      // Toggle between oos and all
      const newView = currentView === 'oos' ? 'all' : 'oos';
      toggleView(newView);
    }
    
    function toggleView(view) {
      currentView = view;
      
      // Update iOS toggle
      const iosToggle = document.getElementById('iosToggle');
      const iosSlider = document.getElementById('iosSlider');
      
      if (view === 'all') {
        iosToggle.classList.add('all-mode');
        iosSlider.textContent = 'All Violations';
      } else {
        iosToggle.classList.remove('all-mode');
        iosSlider.textContent = 'OOS Only';
      }
      
      if (view === 'oos') {
        // OOS view - update all metrics to show OOS data
        document.getElementById('statLabel').textContent = 'TOTAL OOS';
        document.getElementById('statOOS').textContent = realData.total_oos.toLocaleString();
        document.getElementById('chartTitle').textContent = 'OOS Enforcement Trend';
        
        trendChart.data.datasets[0].data = realData.monthly.oos;
        trendChart.data.datasets[0].label = 'OOS Violations';
        trendChart.data.datasets[0].backgroundColor = 'rgba(30, 58, 138, 0.1)';
        trendChart.data.datasets[0].borderColor = '#1e3a8a';
        
        // Update state rankings for OOS
        updateStateRankings(true);
      } else {
        // All violations view - update all metrics to show total violation data
        document.getElementById('statLabel').textContent = 'TOTAL VIOLATIONS';
        document.getElementById('statOOS').textContent = realData.total_all.toLocaleString();
        document.getElementById('chartTitle').textContent = 'Violation Enforcement Trend';
        
        trendChart.data.datasets[0].data = realData.monthly.all;
        trendChart.data.datasets[0].label = 'All Violations';
        trendChart.data.datasets[0].backgroundColor = 'rgba(59, 130, 246, 0.1)';
        trendChart.data.datasets[0].borderColor = '#3b82f6';
        
        // Update state rankings for all violations
        updateStateRankings(false);
      }
      
      trendChart.update();
      updateKeyInsight();  // Update key insight when switching views
    }
    
    function updateStateRankings(isOOS) {
      // This function would update the state ranking list based on view
      // For now, we'll leave the state ranking as-is since we'd need the data structure
    }

    function updateMapDateRange(range) {
      ['dateAll', 'date1m', 'date3m'].forEach(id => {
        document.getElementById(id).classList.remove('active');
      });
      
      const rangeMap = { 'all': 'dateAll', '1m': 'date1m', '3m': 'date3m' };
      document.getElementById(rangeMap[range]).classList.add('active');
      
      const labels = {
        'all': 'All violations since June 25, 2025',
        '1m': 'Last 30 days',
        '3m': 'Last 3 months'
      };
      document.getElementById('mapDateLabel').textContent = 'Showing: ' + labels[range];
    }

    // Timeline tooltip toggle
    function toggleTooltip(event, index) {
      event.stopPropagation();
      
      const tooltips = document.querySelectorAll('.tooltip-popup');
      const clickedTooltip = tooltips[index];
      
      // Close all other tooltips
      tooltips.forEach((tooltip, i) => {
        if (i !== index) {
          tooltip.classList.remove('active');
        }
      });
      
      // Toggle clicked tooltip
      clickedTooltip.classList.toggle('active');
      activeTooltip = clickedTooltip.classList.contains('active') ? clickedTooltip : null;
    }

    // Close tooltips when clicking outside
    document.addEventListener('click', function(event) {
      const tooltips = document.querySelectorAll('.tooltip-popup');
      tooltips.forEach(tooltip => {
        tooltip.classList.remove('active');
      });
      activeTooltip = null;
    });

    // Initialize dashboard on page load
    window.addEventListener('load', initDashboard);
// ========================================
// STATE DETAIL ANALYSIS FUNCTIONS
// ========================================

let stateDetailChart = null;

// Populate state selector
function populateStateSelector() {
  const selector = document.getElementById('stateSelector');
  if (!selector) return;
  
  // Get all states, excluding "US"
  const allStates = {};
  for (const state in realData.state_monthly) {
    if (state.toUpperCase() !== 'US') {
      allStates[state] = true;
    }
  }
  
  // Sort alphabetically
  const sortedStates = Object.keys(allStates).sort();
  
  sortedStates.forEach(state => {
    const option = document.createElement('option');
    option.value = state;
    option.textContent = state;
    selector.appendChild(option);
  });
}

// Show/hide custom date range
document.getElementById('timeRangeSelector')?.addEventListener('change', function() {
  // Update state detail if state is selected
  const selectedState = document.getElementById('stateSelector').value;
  if (selectedState) {
    updateStateDetail(selectedState);
  }
});

// State selector change
document.getElementById('stateSelector')?.addEventListener('change', function() {
  if (this.value) {
    updateStateDetail(this.value);
  } else {
    document.getElementById('stateDetailContent').classList.add('hidden');
    document.getElementById('stateDetailEmpty').classList.remove('hidden');
  }
});

function updateStateDetail(stateCode) {
  // Get time range
  const timeRange = document.getElementById('timeRangeSelector').value;
  let filteredMonths = [];
  
  const allMonths = realData.monthly.labels;
  
  if (timeRange === 'all') {
    filteredMonths = [...allMonths];
  } else {
    const months = parseInt(timeRange);
    filteredMonths = allMonths.slice(-months);
  }
  
  if (filteredMonths.length === 0) {
    alert('No data available for selected date range');
    return;
  }
  
  // Get state monthly data
  const stateMonthly = realData.state_monthly[stateCode];
  if (!stateMonthly) {
    alert('No data available for this state');
    return;
  }
  
  // Calculate totals and arrays for filtered months
  let totalViolations = 0;
  let oosViolations = 0;
  const monthlyOOS = [];
  const monthlyAll = [];
  
  filteredMonths.forEach(month => {
    const monthData = stateMonthly[month] || { oos: 0, all: 0 };
    monthlyOOS.push(monthData.oos);
    monthlyAll.push(monthData.all);
    oosViolations += monthData.oos;
    totalViolations += monthData.all;
  });
  
  // Calculate trend (last month vs previous month)
  let trendPercent = 0;
  let trendDirection = 'â†’';
  let trendColor = 'text-gray-600';
  let trendLabel = 'No change';
  
  if (monthlyOOS.length >= 2) {
    const lastMonth = monthlyOOS[monthlyOOS.length - 1];
    const prevMonth = monthlyOOS[monthlyOOS.length - 2];
    
    if (prevMonth > 0) {
      trendPercent = ((lastMonth - prevMonth) / prevMonth * 100);
      
      if (trendPercent > 0) {
        trendDirection = 'â†—';
        trendColor = 'text-red-600';
        trendLabel = 'vs Last Month';
      } else if (trendPercent < 0) {
        trendDirection = 'â†˜';
        trendColor = 'text-green-600';
        trendLabel = 'vs Last Month';
      } else {
        trendLabel = 'No change';
      }
    }
  }
  
  // Get national rank - create full state ranking from state_monthly data
  const allStatesRanking = [];
  for (const state in realData.state_monthly) {
    if (state.toUpperCase() === 'US') continue;
    
    let stateOOSTotal = 0;
    for (const month in realData.state_monthly[state]) {
      stateOOSTotal += realData.state_monthly[state][month].oos || 0;
    }
    allStatesRanking.push({ state: state, oos: stateOOSTotal });
  }
  
  // Sort by OOS violations descending
  allStatesRanking.sort((a, b) => b.oos - a.oos);
  
  // Find rank of current state
  const stateRank = allStatesRanking.findIndex(s => s.state === stateCode) + 1;
  
  // Update summary cards
  document.getElementById('stateTotal').textContent = totalViolations.toLocaleString();
  document.getElementById('stateOOS').textContent = oosViolations.toLocaleString();
  
  const trendElement = document.getElementById('stateTrend');
  trendElement.textContent = `${trendDirection} ${trendPercent >= 0 ? '+' : ''}${trendPercent.toFixed(1)}%`;
  trendElement.className = `text-2xl font-bold ${trendColor}`;
  document.getElementById('stateTrendLabel').textContent = trendLabel;
  
  document.getElementById('stateRank').textContent = '#' + stateRank;
  
  // Update chart title
  document.getElementById('stateChartTitle').textContent = 
    `${stateCode} - ${filteredMonths[0]} to ${filteredMonths[filteredMonths.length - 1]}`;
  
  // Update chart
  if (stateDetailChart) {
    stateDetailChart.destroy();
  }
  
  const ctx = document.getElementById('stateDetailChart').getContext('2d');
  stateDetailChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: filteredMonths,
      datasets: [
        {
          label: 'OOS Violations',
          data: monthlyOOS,
          borderColor: '#dc2626',
          backgroundColor: 'rgba(220, 38, 38, 0.1)',
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointRadius: 4,
          pointBackgroundColor: '#dc2626'
        },
        {
          label: 'All Violations',
          data: monthlyAll,
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointRadius: 4,
          pointBackgroundColor: '#3b82f6'
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: 'top',
          labels: {
            usePointStyle: true,
            padding: 15,
            font: { size: 12, weight: '600' }
          }
        },
        tooltip: {
          backgroundColor: 'rgba(0, 0, 0, 0.8)',
          padding: 12,
          cornerRadius: 8
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(0, 0, 0, 0.05)' },
          ticks: {
            font: { size: 11 },
            callback: function(value) {
              return value.toLocaleString();
            }
          }
        },
        x: {
          grid: { display: false },
          ticks: { font: { size: 11 } }
        }
      }
    }
  });
  
  // Show content, hide empty state
  document.getElementById('stateDetailContent').classList.remove('hidden');
  document.getElementById('stateDetailEmpty').classList.add('hidden');
}

// Helper function to parse month label back to date
function parseMonthLabel(label) {
  // label format: "Jan 25" or "Jan '25"
  const parts = label.replace("'", "").split(' ');
  const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  const monthIndex = monthNames.indexOf(parts[0]);
  const year = 2000 + parseInt(parts[1]);
  return new Date(year, monthIndex, 1);
}

  </script>

</body>
</html>